on:
  push:
    branches:
      - main
permissions: {}

jobs:
  trigger_build:
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          egress-policy: audit

      - name: Trigger build of BCR UI
        uses: peter-evans/repository-dispatch@bf47d102fdb849e755b0b0023ea3e81a44b6f570 # v2.1.2
        with:
          repository: bazel-contrib/bcr-ui
          # Fine-grained PAT (https://github.com/settings/personal-access-tokens/new), which needs
          # to be exchanged once a year.
          # Scoped to the `bazel-contrib/bcr-ui` repository.
          # Requires "Read and write" permissions for "Contents" to be able to do the workflow dispatch.
          token: ${{ secrets.BCR_UI_REPO_ACCESS_TOKEN }}
          event-type: on-bcr-trigger
          client-payload: '{"bcrCommitHash": "${{ github.sha }}"}'
